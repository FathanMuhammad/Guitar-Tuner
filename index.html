<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProGuitar Tuner</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide icons as inline SVG
    const Mic = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
      </svg>
    );

    const MicOff = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
      </svg>
    );

    const AlertCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01" />
      </svg>
    );

    const GuitarTuner = () => {
      const [isListening, setIsListening] = useState(false);
      const [frequency, setFrequency] = useState(0);
      const [note, setNote] = useState('');
      const [cents, setCents] = useState(0);
      const [closestString, setClosestString] = useState('');
      const [error, setError] = useState('');
      const [stableFrequency, setStableFrequency] = useState(0);

      const audioContextRef = useRef(null);
      const analyserRef = useRef(null);
      const microphoneRef = useRef(null);
      const rafIdRef = useRef(null);
      const streamRef = useRef(null);
      const frequencyBufferRef = useRef([]);
      const lastStableNoteRef = useRef('');
      const noteConfidenceRef = useRef(0);
      const smoothingFactor = 0.3; // Smoothing factor for frequency stability

      const guitarStrings = [
        { name: 'E', frequency: 82.41, string: 'E₂', position: 6, color: 'from-amber-100 to-amber-300', thickness: 'h-2' },
        { name: 'A', frequency: 110.00, string: 'A₂', position: 5, color: 'from-yellow-100 to-yellow-300', thickness: 'h-1.5' },
        { name: 'D', frequency: 146.83, string: 'D₃', position: 4, color: 'from-orange-100 to-orange-300', thickness: 'h-1.5' },
        { name: 'G', frequency: 196.00, string: 'G₃', position: 3, color: 'from-red-100 to-red-300', thickness: 'h-1' },
        { name: 'B', frequency: 246.94, string: 'B₃', position: 2, color: 'from-pink-100 to-pink-300', thickness: 'h-1' },
        { name: 'E', frequency: 329.63, string: 'E₄', position: 1, color: 'from-purple-100 to-purple-300', thickness: 'h-0.5' }
      ];

      const noteStrings = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

      const frequencyToNote = (freq) => {
        if (freq <= 0) return '';
        const noteNum = 12 * (Math.log(freq / 440) / Math.log(2));
        const roundedNoteNum = Math.round(noteNum) + 69;
        const noteIndex = ((roundedNoteNum % 12) + 12) % 12;
        const octave = Math.floor(roundedNoteNum / 12) - 1;
        return {
          name: noteStrings[noteIndex],
          octave: octave,
          cents: Math.round((noteNum - Math.round(noteNum)) * 100)
        };
      };

      const getCents = (freq, targetFreq) => {
        return Math.floor(1200 * Math.log(freq / targetFreq) / Math.log(2));
      };

      const findClosestString = (freq) => {
        if (freq <= 0) return guitarStrings[0];

        let closest = guitarStrings[0];
        let minDiff = Math.abs(freq - closest.frequency);

        for (let string of guitarStrings) {
          const diff = Math.abs(freq - string.frequency);
          if (diff < minDiff) {
            minDiff = diff;
            closest = string;
          }
        }

        return closest;
      };

      // Advanced pitch detection using YIN algorithm (simplified)
      const detectPitchYIN = (buffer, sampleRate) => {
        const bufferLength = buffer.length;

        // Compute difference function
        const tauMax = Math.floor(bufferLength / 2);
        const difference = new Array(tauMax).fill(0);

        for (let tau = 0; tau < tauMax; tau++) {
          for (let i = 0; i < bufferLength - tau; i++) {
            const delta = buffer[i] - buffer[i + tau];
            difference[tau] += delta * delta;
          }
        }

        // Cumulative mean normalized difference function
        const cmndf = new Array(tauMax).fill(0);
        cmndf[0] = 1;
        let runningSum = 0;

        for (let tau = 1; tau < tauMax; tau++) {
          runningSum += difference[tau];
          cmndf[tau] = difference[tau] * tau / runningSum;
        }

        // Find the first local minimum below threshold
        const threshold = 0.1;
        let tau = 2;
        while (tau < tauMax - 1 &&
          !(cmndf[tau] < threshold &&
            cmndf[tau] < cmndf[tau - 1] &&
            cmndf[tau] < cmndf[tau + 1])) {
          tau++;
        }

        if (tau >= tauMax - 1) return -1;

        // Parabolic interpolation for better accuracy
        let betterTau = tau;
        if (tau > 0 && tau < tauMax - 1) {
          const s0 = cmndf[tau - 1];
          const s1 = cmndf[tau];
          const s2 = cmndf[tau + 1];
          betterTau = tau + (s0 - s2) / (2 * (s0 - 2 * s1 + s2));
        }

        const frequency = sampleRate / betterTau;

        // Validate frequency range for guitar
        if (frequency >= 70 && frequency <= 400) {
          return frequency;
        }

        return -1;
      };

      const detectPitch = () => {
        if (!analyserRef.current) return;

        const bufferLength = analyserRef.current.fftSize;
        const buffer = new Float32Array(bufferLength);
        analyserRef.current.getFloatTimeDomainData(buffer);

        // Use YIN algorithm for better accuracy
        const detectedFreq = detectPitchYIN(buffer, audioContextRef.current.sampleRate);

        if (detectedFreq !== -1) {
          // Apply exponential smoothing
          const smoothedFreq = stableFrequency > 0
            ? stableFrequency * smoothingFactor + detectedFreq * (1 - smoothingFactor)
            : detectedFreq;

          setStableFrequency(smoothedFreq);
          setFrequency(smoothedFreq);

          const noteInfo = frequencyToNote(smoothedFreq);
          const currentNote = noteInfo.name + noteInfo.octave;

          // Note stability detection
          if (currentNote === lastStableNoteRef.current) {
            noteConfidenceRef.current = Math.min(noteConfidenceRef.current + 1, 10);
          } else {
            noteConfidenceRef.current = Math.max(noteConfidenceRef.current - 2, 0);
            if (noteConfidenceRef.current === 0) {
              lastStableNoteRef.current = currentNote;
            }
          }

          // Only update note display when confident
          if (noteConfidenceRef.current >= 3) {
            setNote(noteInfo.name);

            const closest = findClosestString(smoothedFreq);
            setClosestString(closest.string);
            const centsOff = getCents(smoothedFreq, closest.frequency);
            setCents(centsOff);
          }
        } else {
          // If no frequency detected, slowly decay the confidence
          noteConfidenceRef.current = Math.max(noteConfidenceRef.current - 0.5, 0);
        }

        rafIdRef.current = requestAnimationFrame(detectPitch);
      };

      const startListening = async () => {
        try {
          setError('');

          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            throw new Error('Microphone access not supported in this browser');
          }

          const stream = await navigator.mediaDevices.getUserMedia({
            audio: {
              echoCancellation: false,
              autoGainControl: false,
              noiseSuppression: false,
              sampleRate: 44100,
              channelCount: 1
            }
          });

          streamRef.current = stream;

          const AudioContext = window.AudioContext || window.webkitAudioContext;
          if (!AudioContext) {
            throw new Error('Web Audio API not supported');
          }

          audioContextRef.current = new AudioContext({ sampleRate: 44100 });
          analyserRef.current = audioContextRef.current.createAnalyser();
          microphoneRef.current = audioContextRef.current.createMediaStreamSource(stream);

          // Higher FFT size for better frequency resolution
          analyserRef.current.fftSize = 8192;
          analyserRef.current.smoothingTimeConstant = 0.8;
          microphoneRef.current.connect(analyserRef.current);

          // Reset stability tracking
          frequencyBufferRef.current = [];
          lastStableNoteRef.current = '';
          noteConfidenceRef.current = 0;

          setIsListening(true);
          detectPitch();
        } catch (err) {
          console.error('Error accessing microphone:', err);

          if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
            setError('Microphone access denied. Please allow microphone permission.');
          } else if (err.name === 'NotFoundError') {
            setError('No microphone found. Please connect a microphone.');
          } else {
            setError(`Error: ${err.message}`);
          }
        }
      };

      const stopListening = () => {
        if (rafIdRef.current) {
          cancelAnimationFrame(rafIdRef.current);
        }
        if (microphoneRef.current) {
          microphoneRef.current.disconnect();
        }
        if (audioContextRef.current) {
          audioContextRef.current.close();
        }
        if (streamRef.current) {
          streamRef.current.getTracks().forEach(track => track.stop());
        }

        setIsListening(false);
        setFrequency(0);
        setStableFrequency(0);
        setNote('');
        setCents(0);
        setClosestString('');
        frequencyBufferRef.current = [];
        noteConfidenceRef.current = 0;
      };

      useEffect(() => {
        return () => {
          stopListening();
        };
      }, []);

      const needleRotation = Math.max(-50, Math.min(50, cents * 2));

      // Calculate position for note ruler (moving ruler, fixed center indicator)
      const getNoteRulerPosition = () => {
        if (!note || stableFrequency <= 0) return 0;

        const targetNote = findClosestString(stableFrequency);
        const centsOffset = getCents(stableFrequency, targetNote.frequency);

        // Each cent should move the ruler by a small amount
        // 50 cents = semitone = one note position
        // Scale factor to control how much the ruler moves
        const centsAdjustment = (centsOffset / 50) * (100 / 12);

        return centsAdjustment;
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black flex flex-col" style={{ minHeight: '100dvh' }}>
          {/* Top Control Section */}
          <div className="bg-gradient-to-b from-gray-800 to-gray-900 p-4 border-b border-gray-700">
            <div className="max-w-md mx-auto">
              <div className="flex flex-col items-center space-y-4">
                <h1 className="text-2xl font-bold text-white" style={{ fontFamily: 'serif' }}>
                  ProGuitar Tuner
                </h1>

                {/* Main Control Button */}
                <button
                  onClick={isListening ? stopListening : startListening}
                  className={`${isListening
                      ? 'bg-gradient-to-r from-red-600 to-red-800 hover:from-red-700 hover:to-red-900 shadow-red-500/30'
                      : 'bg-gradient-to-r from-green-600 to-green-800 hover:from-green-700 hover:to-green-900 shadow-green-500/30'
                    } text-white font-bold py-4 px-10 rounded-full transition-all transform hover:scale-105 flex items-center shadow-lg border-2 border-gray-700`}
                >
                  {isListening ? (
                    <>
                      <MicOff className="w-6 h-6 mr-3" />
                      <span className="text-lg">Stop Tuning</span>
                    </>
                  ) : (
                    <>
                      <Mic className="w-6 h-6 mr-3" />
                      <span className="text-lg">Start Tuning</span>
                    </>
                  )}
                </button>

                {error && (
                  <div className="bg-red-900 border border-red-700 rounded-lg p-3 flex items-start w-full">
                    <AlertCircle className="w-5 h-5 text-red-400 mr-2 flex-shrink-0 mt-0.5" />
                    <p className="text-red-200 text-sm">{error}</p>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Analog Meter Section */}
          <div className="bg-gradient-to-b from-amber-100 to-amber-50 p-6 relative">
            <div className="max-w-md mx-auto relative">
              {/* Indicator light positioned above needle anchor */}
              <div className="absolute -top-4 left-1/2 transform -translate-x-1/2 z-10">
                <div className={`w-12 h-12 rounded-full border-4 border-gray-800 shadow-inner transition-all ${isListening && Math.abs(cents) < 5
                    ? 'bg-gradient-to-br from-green-400 to-green-600 shadow-green-500'
                    : isListening
                      ? 'bg-gradient-to-br from-red-500 to-red-700 shadow-red-500'
                      : 'bg-gray-600'
                  }`} style={{
                    boxShadow: isListening ? '0 0 15px currentColor, inset 0 2px 8px rgba(0,0,0,0.3)' : 'inset 0 2px 8px rgba(0,0,0,0.3)'
                  }}></div>
              </div>

              {/* Meter Scale */}
              <div className="relative h-48">
                <svg viewBox="0 0 200 120" className="w-full">
                  {/* Scale arc */}
                  <path
                    d="M 20 100 A 80 80 0 0 1 180 100"
                    fill="none"
                    stroke="#333"
                    strokeWidth="0.5"
                  />

                  {/* Scale marks */}
                  {[-40, -30, -20, -10, 0, 10, 20, 30, 40].map((val, i) => {
                    const angle = (val / 50) * 70 - 90;
                    const rad = (angle * Math.PI) / 180;
                    const x1 = 100 + 75 * Math.cos(rad);
                    const y1 = 100 + 75 * Math.sin(rad);
                    const x2 = 100 + 70 * Math.cos(rad);
                    const y2 = 100 + 70 * Math.sin(rad);

                    return (
                      <g key={val}>
                        <line x1={x1} y1={y1} x2={x2} y2={y2} stroke="#333" strokeWidth="1" />
                        <text
                          x={100 + 62 * Math.cos(rad)}
                          y={100 + 62 * Math.sin(rad)}
                          textAnchor="middle"
                          dominantBaseline="middle"
                          fontSize="6"
                          fill="#333"
                        >
                          {val > 0 ? `+${val}` : val}
                        </text>
                      </g>
                    );
                  })}

                  {/* Needle */}
                  <g transform={`rotate(${needleRotation} 100 100)`}>
                    <line x1="100" y1="100" x2="100" y2="35" stroke="#333" strokeWidth="2" />
                    <circle cx="100" cy="100" r="3" fill="#333" />
                  </g>

                  {/* Center text */}
                  <text x="100" y="80" textAnchor="middle" fontSize="10" fill="#333" fontFamily="serif">
                    cents
                  </text>

                  {/* Current cents display */}
                  <text x="100" y="110" textAnchor="middle" fontSize="14" fill="#333" fontFamily="serif" fontWeight="bold">
                    {cents > 0 ? `+${cents}` : cents}
                  </text>
                </svg>
              </div>
            </div>
          </div>

          {/* Ruler Note Display Section */}
          <div className="bg-gradient-to-b from-red-900 to-red-950 p-4">
            <div className="max-w-md mx-auto">
              <div className="flex items-center justify-between mb-4">
                <div className="text-amber-200 italic font-serif">Tuning Ruler</div>
                <div className="text-amber-300 text-sm">
                  {stableFrequency > 0 ? `${stableFrequency.toFixed(1)} Hz` : 'Waiting for input...'}
                </div>
              </div>

              {/* Ruler Container - Fixed Center, Moving Notes */}
              <div className="relative bg-gradient-to-r from-amber-900 via-amber-800 to-amber-900 rounded-xl p-4 border-4 border-amber-900 shadow-inner overflow-hidden">
                {/* Center Perfect Tune Indicator (Fixed) */}
                <div className="absolute top-0 bottom-0 left-1/2 w-1 bg-gradient-to-t from-amber-400 via-amber-300 to-amber-400 z-20 transform -translate-x-1/2">
                  <div className="absolute -top-4 left-1/2 transform -translate-x-1/2 text-xs font-bold text-amber-300 bg-amber-900 px-2 py-1 rounded">
                    PERFECT
                  </div>
                  <div className="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs font-bold text-amber-300 bg-amber-900 px-2 py-1 rounded">
                    CENTER
                  </div>
                </div>

                {/* Ruler Scale Lines */}
                <div className="absolute top-0 bottom-0 left-0 right-0 flex items-center">
                  {[...Array(25)].map((_, i) => {
                    const position = (i * 4); // 0-100%
                    const isCenter = position === 50;
                    const isMajor = i % 3 === 0;

                    return (
                      <div
                        key={i}
                        className={`absolute ${isCenter ? 'bg-amber-400' :
                            isMajor ? 'bg-amber-300' : 'bg-amber-200/50'
                          } ${isCenter ? 'w-0.5 h-8' : isMajor ? 'w-0.5 h-6' : 'w-0.5 h-4'}`}
                        style={{ left: `${position}%`, transform: 'translateX(-50%)' }}
                      ></div>
                    );
                  })}
                </div>

                {/* Simplified Moving Notes Ruler - Single segment */}
                <div
                  className="relative h-16 transition-all duration-300 ease-out"
                  style={{ transform: `translateX(${getNoteRulerPosition()}%)` }}
                >
                  {/* Create a single array of notes that's wide enough */}
                  {[...Array(3)].flatMap((_, segment) =>
                    noteStrings.map((noteName, index) => {
                      const absoluteIndex = (segment * noteStrings.length) + index;
                      const totalNotes = noteStrings.length * 3;
                      const position = (absoluteIndex / (totalNotes - 1)) * 100;
                      const currentNoteInfo = frequencyToNote(stableFrequency);
                      const isActive = currentNoteInfo.name === noteName && Math.abs(cents) < 25;

                      return (
                        <div
                          key={`${segment}-${noteName}-${index}`}
                          className={`absolute flex flex-col items-center transition-all duration-200 ${isActive ? 'z-10 scale-125' : 'z-0'
                            }`}
                          style={{
                            left: `${position}%`,
                            transform: 'translateX(-50%)'
                          }}
                        >
                          <div className={`text-center font-bold ${isActive
                              ? 'text-2xl text-amber-200 drop-shadow-lg'
                              : segment === 1 ? 'text-lg text-amber-100' : 'text-sm text-amber-100/50'
                            }`} style={{ fontFamily: 'serif' }}>
                            {noteName}
                            <span className="text-xs ml-1 opacity-70">
                              {Math.floor(currentNoteInfo.octave) + segment - 1}
                            </span>
                          </div>

                          {/* Show target frequency for the active note */}
                          {isActive && stableFrequency > 0 && (
                            <div className="absolute -bottom-6 text-xs text-amber-400 bg-amber-900/80 px-2 py-1 rounded">
                              Target: {findClosestString(stableFrequency).frequency.toFixed(1)} Hz
                            </div>
                          )}
                        </div>
                      );
                    })
                  )}
                </div>

                {/* Center Note Display */}
                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-30">
                  <div className="bg-gradient-to-r from-amber-200 via-amber-100 to-amber-200 rounded-xl p-3 border-4 border-amber-900 shadow-lg flex flex-col items-center min-w-[100px]">
                    <div className="text-amber-900 font-serif italic text-sm">Current</div>
                    <div className="text-4xl font-bold text-amber-900" style={{ fontFamily: 'serif' }}>
                      {note || '--'}
                    </div>
                    {closestString && (
                      <div className="text-amber-800 font-semibold text-sm">
                        {closestString}
                      </div>
                    )}
                  </div>
                </div>


                {/* Center Note Display */}
                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-30">
                  <div className="bg-gradient-to-r from-amber-200 via-amber-100 to-amber-200 rounded-xl p-3 border-4 border-amber-900 shadow-lg flex flex-col items-center min-w-[100px]">
                    <div className="text-amber-900 font-serif italic text-sm">Center Note</div>
                    <div className="text-4xl font-bold text-amber-900" style={{ fontFamily: 'serif' }}>
                      {note || '--'}
                    </div>
                    {closestString && (
                      <div className="text-amber-800 font-semibold text-sm">
                        {closestString}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* Cent Marks */}
              <div className="mt-4 pt-2">
                <div className="flex justify-between text-amber-600 text-xs mb-1">
                  <span>-50¢ Sharp</span>
                  <span className="text-amber-400 font-bold">0¢ Perfect</span>
                  <span>+50¢ Flat</span>
                </div>
                <div className="h-2 bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 rounded-full relative">
                  <div
                    className="absolute top-0 bottom-0 w-1 bg-amber-900 transform -translate-x-1/2 shadow-lg"
                    style={{ left: `${50 + (cents)}%` }}
                  ></div>
                </div>
                <div className="flex justify-between mt-1">
                  <div className="text-xs text-amber-500">(Higher)</div>
                  <div className="text-xs text-amber-500">(Lower)</div>
                </div>
              </div>
            </div>
          </div>

          {/* Fretboard Section */}
          <div className="flex-1 bg-gradient-to-b from-gray-900 to-black p-4">
            <div className="max-w-md mx-auto">
              {/* Fretboard */}
              <div className="relative bg-gradient-to-b from-amber-900 to-amber-950 rounded-xl p-4 border-4 border-gray-800 shadow-xl">
                {/* Fret markers */}
                <div className="absolute left-8 top-0 bottom-0 w-1 bg-amber-700"></div>
                <div className="absolute left-1/3 top-0 bottom-0 w-1 bg-amber-700"></div>
                <div className="absolute right-1/3 top-0 bottom-0 w-1 bg-amber-700"></div>
                <div className="absolute right-8 top-0 bottom-0 w-1 bg-amber-700"></div>

                {/* Guitar strings - EADGBE from bottom to top */}
                <div className="space-y-6">
                  {guitarStrings.slice().reverse().map((string, idx) => (
                    <div key={idx} className="relative">
                      {/* String line with varying thickness */}
                      <div className={`${string.thickness} bg-gradient-to-r ${string.color} rounded-full relative`}>
                        {/* String highlight */}
                        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent rounded-full"></div>
                      </div>

                      {/* Note button - positioned to the right */}
                      <div
                        className={`absolute -top-3 px-2 py-3 rounded-lg font-bold text-sm transition-all duration-300 shadow-lg border-2 ${closestString === string.string
                            ? 'bg-gradient-to-r from-amber-500 to-amber-700 text-white scale-105 shadow-amber-500/50 border-amber-300'
                            : 'bg-gradient-to-r from-gray-700 to-gray-900 text-gray-300 border-gray-600'
                          }`}
                        style={{
                          left: `${(6 - string.position) * 12 + 10}%`
                        }}
                      >
                        <div className="flex flex-col items-center">
                          <span className="text-lg">{string.string}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Frequency Display */}
              {stableFrequency > 0 && (
                <div className="mt-4 bg-gray-800 rounded-lg p-3 border border-gray-700">
                  <div className="grid grid-cols-2 gap-3">
                    <div className="text-gray-300">Frequency:</div>
                    <div className="text-green-400 font-bold text-right">{stableFrequency.toFixed(1)} Hz</div>

                    <div className="text-gray-300">Note Confidence:</div>
                    <div className="text-right">
                      <div className="inline-flex items-center">
                        <div className="w-16 h-2 bg-gray-700 rounded-full overflow-hidden mr-2">
                          <div
                            className="h-full bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 transition-all duration-300"
                            style={{ width: `${(noteConfidenceRef.current / 10) * 100}%` }}
                          ></div>
                        </div>
                        <span className="text-yellow-400 font-bold">{noteConfidenceRef.current.toFixed(0)}/10</span>
                      </div>
                    </div>

                    <div className="text-gray-300">Tuning Status:</div>
                    <div className={`font-bold text-right ${Math.abs(cents) < 5 ? 'text-green-400' :
                        Math.abs(cents) < 20 ? 'text-yellow-400' : 'text-red-400'
                      }`}>
                      {Math.abs(cents) < 5 ? 'Perfect!' :
                        Math.abs(cents) < 20 ? 'Close' : 'Needs Adjustment'}
                    </div>
                  </div>
                </div>
              )}

              {/* Instructions */}
              {!isListening && (
                <div className="mt-10 text-center text-gray-400 text-sm">
                  <p>Click "Start Tuning" above and play a string</p>
                  <p className="mt-1">Tune until the needle is centered and light turns green</p>
                  <p className="mt-1">Ruler moves to show pitch relative to perfect tuning</p>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GuitarTuner />);
  </script>
</body>

</html>